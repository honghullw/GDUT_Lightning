#include "data_process.h"
double inductance_data_max[5]={1,1,1,1,1};


extern a data;
extern b speed_data;
extern c angle_data;

extern e up_pid;
extern e speed_pid;
extern e direction_pid;
extern e current_pid;
//-------------------------------------------------------------------------------------------------------------------
// @brief		??????????
// @param		ch				???ADC???
// @param		resolution		??????????????(????????????????????????????? ???????????????????完)
// @return		void
// Sample usage:				adc_init(ADC_1, ADC1_CH00_A00, ADC_8BIT);						//?????A00?ADC???? ??????8竹
//-------------------------------------------------------------------------------------------------------------------
void AngularSpeedAngleCalculate(){
  
  angle_data.angular_speed_y_data-=zero_angular_speed_y_data;//?????????????????????
  angle_data.angularspeed_angle_value=angle_data.angularspeed_angle_value+angle_data.angular_speed_y_data*change_angle_coefficient;//?????????????????????????????????????忪?????

}


//-------------------------------------------------------------------------------------------------------------------
// @brief		???????(????)
// @param		ch				???ADC???
// @param		resolution		??????????????(????????????????????????????? ???????????????????完)
// @return		void
// Sample usage:				adc_init(ADC_1, ADC1_CH00_A00, ADC_8BIT);						//?????A00?ADC???? ??????8竹
//-------------------------------------------------------------------------------------------------------------------
void FuseAngleCalculate(){

angle_data.angularspeed_angle_value=angle_data.angularspeed_angle_value+(angle_data.accelerate_angle_value-angle_data.angularspeed_angle_value)*complementary_coefficient;//???????????????????
angle_data.fuse_angle_value=angle_data.angularspeed_angle_value;//????????????????????????
angle_data.fuse_angle_pid_value=angle_data.fuse_angle_value-balance_angle_value;//??????竹??????0//????pid????

}




//-------------------------------------------------------------------------------------------------------------------
// @brief		ADC
// @param		ch				???ADC???
// @param		resolution		??????????????(????????????????????????????? ???????????????????完)
// @return		void
// Sample usage:				adc_init(ADC_1, ADC1_CH00_A00, ADC_8BIT);						//?????A00?ADC???? ??????8竹
//-------------------------------------------------------------------------------------------------------------------
void ADCFilterProcess()
{
  MedianAverageFilter();//??竹???????
//  TimeWeightFilter();//?????????

}



//-------------------------------------------------------------------------------------------------------------------
// @brief		????????????????????????????????????????????????????????????????
// @param		ch				???ADC???
// @param		resolution		??????????????(????????????????????????????? ???????????????????完)
// @return		void
// Sample usage:				adc_init(ADC_1, ADC1_CH00_A00, ADC_8BIT);						//?????A00?ADC???? ??????8竹
//-------------------------------------------------------------------------------------------------------------------
void InductanceProcess(){
  uint16 i=0;
  for(;i<inductance_num;i++)
  {
     data.inductance_normalization[i]=data.filter_inductance_data[i]/inductance_data_max[i];//??????/(???????-?????妊?)
     if(data.inductance_normalization[i]<=0.001)
     {
      data.inductance_normalization[i]=0.001;
     }
  }
}

//-------------------------------------------------------------------------------------------------------------------
// @brief		????(??????????????)
// @param		ch				???ADC???
// @param		resolution		??????????????(????????????????????????????? ???????????????????完)
// @return		void
// Sample usage:				adc_init(ADC_1, ADC1_CH00_A00, ADC_8BIT);						//?????A00?ADC???? ??????8竹
//-------------------------------------------------------------------------------------------------------------------
float DirectionErrorOutput1()
{
  float DirectionErrorOutput=
  ((data.inductance_normalization[0]-data.inductance_normalization[2])/(data.inductance_normalization[0]+data.inductance_normalization[2])+data.inductance_normalization[1])/2;//???????????
      return DirectionErrorOutput;
}

//-------------------------------------------------------------------------------------------------------------------
// @brief		?????(??????????????)
// @param		ch				???ADC???
// @param		resolution		??????????????(????????????????????????????? ???????????????????完)
// @return		void
// Sample usage:				adc_init(ADC_1, ADC1_CH00_A00, ADC_8BIT);						//?????A00?ADC???? ??????8竹
//-------------------------------------------------------------------------------------------------------------------
float DirectionErrorOutput2()
{
    float DirectionErrorOutput=
    FastAbs((FastSqrt(data.inductance_normalization[0])-FastSqrt(data.inductance_normalization[4]))/(data.inductance_normalization[0]+data.inductance_normalization[2]));
    data.position_error=DirectionErrorOutput;
    return DirectionErrorOutput;
}

//-------------------------------------------------------------------------------------------------------------------
// @brief		?????(??????????????)
// @param		ch				???ADC???
// @param		resolution		??????????????(????????????????????????????? ???????????????????完)
// @return		void
// Sample usage:				adc_init(ADC_1, ADC1_CH00_A00, ADC_8BIT);						//?????A00?ADC???? ??????8竹
//-------------------------------------------------------------------------------------------------------------------
void DirectionErrorOutput3()
{
//  direction_pid.actual_value=
    //?????????????扶?????????
      
}

//-------------------------------------------------------------------------------------------------------------------
// @brief		?????????
// @param		ch				???ADC???
// @param		resolution		??????????????(????????????????????????????? ???????????????????完)
// @return		void
// Sample usage:				adc_init(ADC_1, ADC1_CH00_A00, ADC_8BIT);						//?????A00?ADC???? ??????8竹
//-------------------------------------------------------------------------------------------------------------------
void TotalDataProcess()
{
  AngularSpeedAngleCalculate();
  FuseAngleCalculate();
  ADCFilterProcess();
  InductanceProcess();
  DirectionErrorOutput1();//????
//  DirectionErrorOutput2();//?????
}